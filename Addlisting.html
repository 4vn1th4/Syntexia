<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Provider Dashboard ‚Äî FoodLink</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- LEAFLET -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  font-family: "Inter", sans-serif;
}

body {
  background: radial-gradient(circle at top right, #0f2a44, #050b14);
  color: #e5e7eb;
  min-height: 100vh;
  padding-top: 120px;
  display: flex;
  justify-content: center;
}

nav {
  position: fixed;
  top: 20px;
  left: 50%;
  transform: translateX(-50%);
  width: 90%;
  max-width: 1200px;
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(14px);
  border-radius: 18px;
  padding: 14px 28px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  z-index: 1000;
}

/* From Uiverse.io by abdul12commando */
/* === removing default button style ===*/
.logo {
  margin: 0;
  height: auto;
  background: transparent;
  padding: 0;
  border: none;
}

/* button styling */
.logo {
  --border-right: 6px;
  --text-stroke-color: rgba(201, 187, 187, 0.6);
  --animation-color: #22c55e;
  --fs-size: 2em;
  letter-spacing: 3px;
  text-decoration: none;
  font-size: var(--fs-size);
  font-family: "Arial";
  position: relative;
  text-transform: uppercase;
  color: transparent;
  -webkit-text-stroke: 1px var(--text-stroke-color);
}
/* this is the text, when you hover on button */
.hover-text {
  position: absolute;
  box-sizing: border-box;
  content: attr(data-text);
  color: var(--animation-color);
  width: 0%;
  inset: 0;
  border-right: var(--border-right) solid var(--animation-color);
  overflow: hidden;
  transition: 0.5s;
  -webkit-text-stroke: 1px var(--animation-color);
}
/* hover */
.logo:hover .hover-text {
  width: 100%;
  filter: drop-shadow(0 0 23px var(--animation-color))
}


nav ul {
  list-style: none;
  display: flex;
  gap: 24px;
}

nav ul li {
  cursor: pointer;
  font-size: 14px;
  opacity: 0.85;
}

nav ul li:hover {
  opacity: 1;
}

.nav-btn {
  padding: 8px 16px;
  border-radius: 10px;
  border: 1px solid rgba(255,255,255,0.25);
  background: transparent;
  color: white;
  cursor: pointer;
}
  
.provider-card {
  background: rgba(255,255,255,0.06);
  backdrop-filter: blur(14px);
  border-radius: 24px;
  padding: 40px;
  width: 90%;
  max-width: 520px;
  box-shadow: 0 0 50px rgba(34,197,94,0.2);
}

.provider-card h1 {
  font-size: 30px;
  margin-bottom: 10px;
}

.provider-card p {
  opacity: 0.85;
  margin-bottom: 25px;
}

.provider-card input,
.provider-card select {
  width: 100%;
  padding: 12px 14px;
  margin-bottom: 18px;
  border-radius: 12px;
  border: none;
  outline: none;
  background: rgba(255,255,255,0.08);
  color: #e5e7eb;
}

.provider-card input::placeholder {
  color: #cbd5e1;
}

.submit-btn {
  width: 100%;
  padding: 14px;
  border-radius: 14px;
  border: none;
  background: linear-gradient(135deg, #22c55e, #16a34a);
  color: #04110a;
  font-weight: 600;
  cursor: pointer;
}

#textBlack{
  color: black;
}

#map {
  height: 260px;
  border-radius: 16px;
  margin-bottom: 18px;
}

#aiResult {
  margin-top: 15px;
  font-weight: bold;
  color: #22c55e;
}
</style>
</head>

<body>
<!-- NAVBAR -->
<nav>
  <!-- <div class="logo">FOODLINK</div> -->
  <button class="logo" data-text="Awesome">
    <span class="actual-text">&nbsp;FOODLINK&nbsp;</span>
    <span aria-hidden="true" class="hover-text">&nbsp;FOODLINK&nbsp;</span>
 </button>
  <ul>
    <button class="nav-btn" onclick="location.href='index.html'">Home</button>
    <button class="nav-btn" onclick="location.href='provider.html'">Provider</button>
    <button class="nav-btn" onclick="location.href='receiver.html'">Receiver</button>
  </ul>
  <button class="nav-btn" onclick="location.href='login.html'">Login</button> 
</nav>
<div class="provider-card">
  <h1>Provider Dashboard</h1>
  <p>List your food for AI verification</p>

  <form id="providerForm">

    <input type="file" id="foodImage" required>

    <select id="foodType" required>
      <option value="">Select Food Type</option>
      <div id="textBlack">
      <option>Vegetables</option>
      <option>Fruits</option>
      <option>Grains</option>
      <option>Dairy</option>
      <option>Prepared Meals</option>
      </div> 
    </select>

    <input type="number" id="quantity" placeholder="Quantity (kg)" required>

    <!-- UPDATED DATE FIELDS -->
    Production Date<input type="date" id="productionDate" required>
    Expiry Date<input type="date" id="expiryDate" required>
    <input type="text" id="pickupWindow" placeholder="Pickup Window e.g. 2-4 PM" required>

    <!-- MAP -->
    <p style="margin-bottom:8px;">üìç Click on map to select pickup location</p>
    <div id="map"></div>

    <!-- Hidden lat/lng -->
    <input type="hidden" id="lat">
    <input type="hidden" id="lng">

    <button type="submit" class="submit-btn">
      Submit for AI Verification
    </button>
  </form>

  <p id="aiResult"></p>
</div>

<script>
/* Photo DB */
  // 1. Initialize Supabase
const supabaseUrl = 'YOUR_SUPABASE_URL';
const supabaseKey = 'YOUR_SUPABASE_ANON_KEY';
const supabase = supabase.createClient(supabaseUrl, supabaseKey);

const form = document.getElementById('providerForm');
const result = document.getElementById('aiResult');
const foodImageInput = document.getElementById('foodImage');

form.addEventListener('submit', async function(e) {
  e.preventDefault();

  const file = foodImageInput.files[0];
  if (!file) {
    alert("Please select a photo first!");
    return;
  }

  result.textContent = "Uploading image to Cloud DB... ‚è≥";

  // 2. Upload only the image
  // We create a unique name so images don't overwrite each other
  const fileName = `folder/${Date.now()}_${file.name}`;

  const { data, error } = await supabase.storage
    .from('food-photos') // Make sure you created this bucket in Supabase
    .upload(fileName, file);

  if (error) {
    result.style.color = "red";
    result.textContent = "Upload Error: " + error.message;
    console.error(error);
  } else {
    result.style.color = "#22c55e";
    result.textContent = "Image saved to Database successfully! ‚úÖ";
    
    // Optional: Get the link if you want to see it
    const { data: urlData } = supabase.storage.from('food-photos').getPublicUrl(fileName);
    console.log("Access your image here:", urlData.publicUrl);
    
    form.reset();
  }
});
  
/* MAP */
let map = L.map('map').setView([25.2048, 55.2708], 10);

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  attribution: '¬© OpenStreetMap'
}).addTo(map);

let marker;

map.on('click', function(e) {
  if (marker) map.removeLayer(marker);

  marker = L.marker(e.latlng)
    .addTo(map)
    .bindPopup("Pickup Location")
    .openPopup();

  lat.value = e.latlng.lat;
  lng.value = e.latlng.lng;
});

/* FORM */
const form = document.getElementById('providerForm');
const result = document.getElementById('aiResult');

form.addEventListener('submit', function(e){
  e.preventDefault();

  if (!lat.value || !lng.value) {
    alert("Please select pickup location on the map");
    return;
  }

  result.textContent = "Verifying with AI... ‚è≥";

  setTimeout(() => {

    const listing = {
      foodType: foodType.value,
      quantity: quantity.value,
      productionDate: productionDate.value,
      expiryDate: expiryDate.value,
      pickupWindow: pickupWindow.value,
      lat: lat.value,
      lng: lng.value
    };

    let listings =
      JSON.parse(localStorage.getItem("foodListings")) || [];

    listings.push(listing);
    localStorage.setItem("foodListings", JSON.stringify(listings));

    result.textContent = "AI Verified: Listing saved ‚úÖ";
    form.reset();
    if (marker) map.removeLayer(marker);

  }, 2000);
});
</script>

</body>
</html>


